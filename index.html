<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vidter â€” Convert your videos</title>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- FFmpeg.wasm -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/ffmpeg.min.js"></script>

  <style>
    :root{
      --bg:#0b0b0b;
      --card:#111213;
      --muted:#9aa0a6;
      --accent:#1e66ff;
      --panel:#1a1a1b;
      --glass: rgba(255,255,255,0.02);
    }
    /* subtle grain/noise background using repeating-radial-gradient */
    body{
      margin:0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.015) 0, rgba(255,255,255,0.00) 2px),
        radial-gradient(circle at 80% 40%, rgba(255,255,255,0.012) 0, rgba(255,255,255,0.00) 2px),
        linear-gradient(180deg,#070707, #0e0e0f);
      min-height:100vh;
      color:#e9eef2;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      flex-direction:column;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:30px 6vw;
      gap:20px;
    }
    .logo{
      font-weight:800;
      font-size:22px;
      letter-spacing:0.3px;
    }
    nav a{
      color:rgba(255,255,255,0.65);
      margin-left:20px;
      text-decoration:none;
      font-size:15px;
    }
    nav a:hover{ color: #fff; }

    main{
      max-width:880px;
      margin: 10px auto 80px;
      width:100%;
      padding: 20px 6vw;
    }

    .hero{
      margin-top:20px;
    }
    .title{
      font-weight:700;
      font-size:44px;
      line-height:1.05;
      margin:10px 0 12px;
      color:#f7f9fb;
    }
    .subtitle{
      color:var(--muted);
      font-size:15px;
      max-width:720px;
      margin-bottom:28px;
    }

    .uploader{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:26px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.01), 0 10px 30px rgba(2,6,23,0.4);
      min-height:240px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      transition: border-color .18s ease, transform .12s ease;
    }
    .uploader.dragover{
      border-color: rgba(30,102,255,0.35);
      transform: translateY(-2px);
    }

    .uploader .inner{
      text-align:center;
      color:rgba(255,255,255,0.6);
      font-size:15px;
    }
    .uploader a.browse{
      color: var(--accent);
      text-decoration:none;
      font-weight:600;
      margin-left:6px;
    }

    input[type=file]{
      display:none;
    }

    .convert-wrap{
      margin-top:20px;
      display:flex;
      align-items:center;
      gap:24px;
      flex-direction:column;
    }

    .convert-btn{
      width:100%;
      max-width:600px;
      background: linear-gradient(180deg, #2b77ff, #1c56e6);
      border-radius:8px;
      padding:16px 22px;
      color:white;
      font-weight:700;
      font-size:16px;
      border:none;
      cursor:pointer;
      box-shadow: 0 8px 30px rgba(30,102,255,0.18), inset 0 -2px 0 rgba(0,0,0,0.15);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .convert-btn:active{ transform:translateY(1px); }

    .format-list{
      width:100%;
      max-width:380px;
      display:flex;
      flex-direction:column;
      gap:14px;
      margin-top:18px;
    }

    .format-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border-radius:10px;
      padding:18px 16px;
      text-align:center;
      border:1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      color:#eaeef2;
      font-weight:600;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      box-shadow: 0 6px 18px rgba(2,6,23,0.45);
    }
    .format-card:hover{
      transform:translateY(-4px);
      box-shadow: 0 12px 30px rgba(2,6,23,0.6);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.03));
    }

    .selected-format{
      margin-top:10px;
      color:var(--muted);
      font-size:14px;
    }

    .progress-container{
      margin-top:20px;
      width:100%;
      max-width:600px;
      display:none;
    }

    .progress-bar{
      width:100%;
      height:6px;
      background: rgba(255,255,255,0.1);
      border-radius:3px;
      overflow:hidden;
      margin-bottom:12px;
    }

    .progress-fill{
      height:100%;
      background: linear-gradient(90deg, #2b77ff, #1c56e6);
      width:0%;
      transition: width 0.3s ease;
      border-radius:3px;
    }

    .progress-text{
      color:var(--muted);
      font-size:14px;
      text-align:center;
    }

    .status-message{
      margin-top:16px;
      padding:12px 16px;
      border-radius:8px;
      font-size:14px;
      text-align:center;
      display:none;
    }

    .status-success{
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .status-error{
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .file-preview{
      margin-top:16px;
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      justify-content:center;
    }

    .file-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:8px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.03);
      min-width:120px;
      text-align:center;
      position:relative;
    }

    .file-thumbnail{
      width:80px;
      height:60px;
      background: rgba(255,255,255,0.05);
      border-radius:6px;
      margin:0 auto 8px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
      color:rgba(255,255,255,0.4);
      overflow:hidden;
    }

    .file-thumbnail img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .file-name{
      font-size:12px;
      color:rgba(255,255,255,0.7);
      margin-bottom:4px;
      word-break:break-word;
    }

    .file-size{
      font-size:11px;
      color:var(--muted);
    }

    .file-remove{
      position:absolute;
      top:-6px;
      right:-6px;
      width:20px;
      height:20px;
      background:rgba(239,68,68,0.9);
      border-radius:50%;
      border:none;
      color:white;
      font-size:12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .settings-panel{
      margin-top:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:20px;
      border:1px solid rgba(255,255,255,0.03);
      display:none;
    }

    .settings-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
    }

    .settings-row:last-child{
      margin-bottom:0;
    }

    .settings-label{
      color:rgba(255,255,255,0.8);
      font-size:14px;
      font-weight:500;
    }

    .settings-control{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .quality-select{
      background: rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:6px;
      padding:6px 12px;
      color:white;
      font-size:13px;
    }

    .quality-select option{
      background:var(--card);
      color:white;
    }

    .queue-panel{
      margin-top:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:20px;
      border:1px solid rgba(255,255,255,0.03);
      display:none;
    }

    .queue-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
    }

    .queue-title{
      color:rgba(255,255,255,0.8);
      font-size:16px;
      font-weight:600;
    }

    .queue-controls{
      display:flex;
      gap:8px;
    }

    .queue-btn{
      background: rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:6px;
      padding:6px 12px;
      color:white;
      font-size:12px;
      cursor:pointer;
      transition: all 0.2s ease;
    }

    .queue-btn:hover{
      background: rgba(255,255,255,0.1);
    }

    .queue-btn.primary{
      background: var(--accent);
      border-color: var(--accent);
    }

    .queue-btn.primary:hover{
      background: #2b77ff;
    }

    .queue-item{
      background: rgba(255,255,255,0.02);
      border-radius:8px;
      padding:12px;
      margin-bottom:8px;
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      align-items:center;
      gap:12px;
    }

    .queue-item:last-child{
      margin-bottom:0;
    }

    .queue-item-status{
      width:8px;
      height:8px;
      border-radius:50%;
      flex-shrink:0;
    }

    .queue-item-status.pending{
      background: var(--muted);
    }

    .queue-item-status.processing{
      background: var(--accent);
      animation: pulse 1.5s infinite;
    }

    .queue-item-status.completed{
      background: #22c55e;
    }

    .queue-item-status.error{
      background: #ef4444;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .queue-item-info{
      flex:1;
      min-width:0;
    }

    .queue-item-name{
      color:rgba(255,255,255,0.8);
      font-size:13px;
      font-weight:500;
      margin-bottom:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .queue-item-details{
      color:var(--muted);
      font-size:11px;
    }

    .queue-item-actions{
      display:flex;
      gap:4px;
    }

    .queue-item-btn{
      background: none;
      border:none;
      color:var(--muted);
      font-size:12px;
      cursor:pointer;
      padding:2px 6px;
      border-radius:4px;
      transition: all 0.2s ease;
    }

    .queue-item-btn:hover{
      background: rgba(255,255,255,0.1);
      color:white;
    }

    .history-panel{
      margin-top:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:20px;
      border:1px solid rgba(255,255,255,0.03);
      display:none;
    }

    .history-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
    }

    .history-title{
      color:rgba(255,255,255,0.8);
      font-size:16px;
      font-weight:600;
    }

    .history-clear{
      background: none;
      border:none;
      color:var(--muted);
      font-size:12px;
      cursor:pointer;
      text-decoration:underline;
    }

    .history-item{
      background: rgba(255,255,255,0.02);
      border-radius:8px;
      padding:12px;
      margin-bottom:8px;
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      align-items:center;
      gap:12px;
    }

    .history-item:last-child{
      margin-bottom:0;
    }

    .history-item-icon{
      width:24px;
      height:24px;
      border-radius:4px;
      background: rgba(34,197,94,0.2);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:#22c55e;
    }

    .history-item-info{
      flex:1;
      min-width:0;
    }

    .history-item-name{
      color:rgba(255,255,255,0.8);
      font-size:13px;
      font-weight:500;
      margin-bottom:2px;
    }

    .history-item-details{
      color:var(--muted);
      font-size:11px;
    }

    .format-suggestion{
      margin-top:8px;
      padding:8px 12px;
      background: rgba(30,102,255,0.1);
      border:1px solid rgba(30,102,255,0.2);
      border-radius:6px;
      font-size:12px;
      color:var(--accent);
    }

    .advanced-settings{
      margin-top:16px;
      padding:16px;
      background: rgba(255,255,255,0.01);
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.02);
    }

    .advanced-toggle{
      background: none;
      border:none;
      color:var(--accent);
      font-size:13px;
      cursor:pointer;
      text-decoration:underline;
      margin-bottom:12px;
    }

    .advanced-options{
      display:none;
    }

    .advanced-options.show{
      display:block;
    }

    .advanced-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }

    .advanced-row:last-child{
      margin-bottom:0;
    }

    .advanced-label{
      color:rgba(255,255,255,0.7);
      font-size:13px;
    }

    .advanced-input{
      background: rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:4px;
      padding:4px 8px;
      color:white;
      font-size:12px;
      width:80px;
      text-align:center;
    }

    .stats-panel{
      margin-top:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:20px;
      border:1px solid rgba(255,255,255,0.03);
      display:none;
    }

    .stats-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap:16px;
    }

    .stat-item{
      text-align:center;
    }

    .stat-value{
      font-size:24px;
      font-weight:700;
      color:var(--accent);
      margin-bottom:4px;
    }

    .stat-label{
      font-size:12px;
      color:var(--muted);
    }

    .shortcuts-panel{
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      background: var(--card);
      border-radius:12px;
      padding:24px;
      border:1px solid rgba(255,255,255,0.1);
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
      z-index:1000;
      display:none;
      max-width:400px;
      width:90%;
    }

    .shortcuts-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:20px;
    }

    .shortcuts-title{
      font-size:18px;
      font-weight:600;
      color:white;
    }

    .shortcuts-close{
      background: none;
      border:none;
      color:var(--muted);
      font-size:20px;
      cursor:pointer;
      padding:0;
      width:24px;
      height:24px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .shortcut-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
      padding:8px 0;
    }

    .shortcut-action{
      color:rgba(255,255,255,0.8);
      font-size:14px;
    }

    .shortcut-key{
      background: rgba(255,255,255,0.1);
      border-radius:4px;
      padding:4px 8px;
      font-size:12px;
      color:white;
      font-family: monospace;
    }

    .overlay{
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background: rgba(0,0,0,0.5);
      z-index:999;
      display:none;
    }

    .loading-spinner{
      display:inline-block;
      width:20px;
      height:20px;
      border:2px solid rgba(255,255,255,0.3);
      border-radius:50%;
      border-top-color:var(--accent);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .notification{
      position:fixed;
      top:20px;
      right:20px;
      background: var(--card);
      border-radius:8px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index:1001;
      transform:translateX(400px);
      transition: transform 0.3s ease;
      max-width:300px;
    }

    .notification.show{
      transform:translateX(0);
    }

    .notification.success{
      border-left:4px solid #22c55e;
    }

    .notification.error{
      border-left:4px solid #ef4444;
    }

    .notification.info{
      border-left:4px solid var(--accent);
    }

    /* small footer band */
    footer{
      margin-top:auto;
      background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.45));
      padding:30px 6vw;
      color:rgba(255,255,255,0.6);
      font-size:14px;
    }

    /* responsive */
    @media (max-width:720px){
      .title{ font-size:34px; }
      .convert-btn { max-width:100%; }
      .format-list{ max-width:100%; }
      header{ padding:18px 5vw; }
      main{ margin-top:6px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Vidter</div>
    <nav aria-label="Main navigation">
      <a href="#">About â–¾</a>
      <a href="#">Playground</a>
      <a href="#">Documentation</a>
    </nav>
  </header>

  <main>
    <section class="hero" aria-labelledby="hero-title">
      <h1 id="hero-title" class="title">Convert your videos</h1>
      <p class="subtitle">Easily convert your video files to any format you need, whether it's MP4, AVI, or MOV. Enjoy seamless compatibility across all devices and platforms!</p>
    </section>

    <section class="uploader" id="uploader" aria-label="File uploader">
      <div class="inner">
        <p id="filehint">Drag and drop your video files here <span style="color:rgba(255,255,255,0.45)">/</span>
          <label for="fileInput" style="display:inline-block;">
            <a class="browse" href="#" onclick="document.getElementById('fileInput').click(); return false;">Browse files</a>
          </label>
        </p>
        <p id="selectedFiles" style="margin-top:12px; font-size:13px; color:rgba(255,255,255,0.45)"></p>
      </div>

             <input id="fileInput" type="file" accept="video/*,audio/*" multiple />
     </section>

     <div id="filePreview" class="file-preview"></div>

     <div id="settingsPanel" class="settings-panel">
       <div class="settings-row">
         <div class="settings-label">Video Quality</div>
         <div class="settings-control">
           <select id="qualitySelect" class="quality-select">
             <option value="high">High Quality</option>
             <option value="medium" selected>Medium Quality</option>
             <option value="low">Low Quality</option>
           </select>
         </div>
       </div>
       <div class="settings-row">
         <div class="settings-label">Audio Bitrate</div>
         <div class="settings-control">
           <select id="audioBitrateSelect" class="quality-select">
             <option value="320">320 kbps</option>
             <option value="256" selected>256 kbps</option>
             <option value="192">192 kbps</option>
             <option value="128">128 kbps</option>
           </select>
         </div>
       </div>

       <div class="advanced-settings">
         <button id="advancedToggle" class="advanced-toggle">Advanced Settings</button>
         <div id="advancedOptions" class="advanced-options">
           <div class="advanced-row">
             <div class="advanced-label">Video Resolution</div>
             <input id="videoResolution" class="advanced-input" type="text" placeholder="1920x1080" value="1920x1080">
           </div>
           <div class="advanced-row">
             <div class="advanced-label">Frame Rate</div>
             <input id="frameRate" class="advanced-input" type="text" placeholder="30" value="30">
           </div>
           <div class="advanced-row">
             <div class="advanced-label">Video Bitrate (Mbps)</div>
             <input id="videoBitrate" class="advanced-input" type="text" placeholder="2" value="2">
           </div>
         </div>
       </div>
     </div>

    <div class="convert-wrap" aria-hidden="false">
      <button id="convertBtn" class="convert-btn" aria-expanded="false" aria-controls="formatList">
        Convert file â–¾
      </button>

             <div id="formatList" class="format-list" style="display: none;">
        <div class="format-card" role="button" data-format="mp4">to MP4</div>
        <div class="format-card" role="button" data-format="webm">to WEBM</div>
        <div class="format-card" role="button" data-format="mov">to MOV</div>
        <div class="format-card" role="button" data-format="avi">to AVI</div>
        <div class="format-card" role="button" data-format="mp3">to MP3</div>
      </div>

      <div id="chosen" class="selected-format" aria-live="polite">      </div>
    </div>

    <div id="queuePanel" class="queue-panel">
      <div class="queue-header">
        <div class="queue-title">Conversion Queue</div>
        <div class="queue-controls">
          <button id="pauseQueueBtn" class="queue-btn">Pause</button>
          <button id="clearQueueBtn" class="queue-btn">Clear</button>
          <button id="startQueueBtn" class="queue-btn primary">Start All</button>
        </div>
      </div>
      <div id="queueList"></div>
    </div>

    <div id="historyPanel" class="history-panel">
      <div class="history-header">
        <div class="history-title">Recent Conversions</div>
        <button id="clearHistoryBtn" class="history-clear">Clear History</button>
      </div>
      <div id="historyList"></div>
    </div>

    <div id="progressContainer" class="progress-container">
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill"></div>
      </div>
      <div id="progressText" class="progress-text">Initializing...</div>
    </div>

    <div id="statusMessage" class="status-message"></div>
  </main>

  <footer>
    <div style="max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:16px;">
      <div>Free conversion â€” no sign-up required Â· Files processed locally Â· Queue system & history</div>
      <div>Â© Vidter</div>
    </div>
  </footer>

  <script>
    const uploader = document.getElementById('uploader');
    const fileInput = document.getElementById('fileInput');
    const selectedText = document.getElementById('selectedFiles');
    const filehint = document.getElementById('filehint');
    const convertBtn = document.getElementById('convertBtn');
    const formatList = document.getElementById('formatList');
    const chosen = document.getElementById('chosen');
    const progressContainer = document.getElementById('progressContainer');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const statusMessage = document.getElementById('statusMessage');
    const filePreview = document.getElementById('filePreview');
    const settingsPanel = document.getElementById('settingsPanel');
    const qualitySelect = document.getElementById('qualitySelect');
    const audioBitrateSelect = document.getElementById('audioBitrateSelect');
    const queuePanel = document.getElementById('queuePanel');
    const queueList = document.getElementById('queueList');
    const startQueueBtn = document.getElementById('startQueueBtn');
    const pauseQueueBtn = document.getElementById('pauseQueueBtn');
    const clearQueueBtn = document.getElementById('clearQueueBtn');
    const historyPanel = document.getElementById('historyPanel');
    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const advancedToggle = document.getElementById('advancedToggle');
    const advancedOptions = document.getElementById('advancedOptions');
    const videoResolution = document.getElementById('videoResolution');
    const frameRate = document.getElementById('frameRate');
    const videoBitrate = document.getElementById('videoBitrate');

    let files = [];
    let targetFormat = null;
    let ffmpeg = null;
    let conversionQueue = [];
    let isQueueRunning = false;
    let isQueuePaused = false;
    let conversionHistory = [];
    let stats = {
      totalConversions: 0,
      totalFilesProcessed: 0,
      totalTimeSaved: 0,
      averageConversionTime: 0
    };
    
    // Configuration
    const MAX_FILE_SIZE = 500 * 1024 * 1024; // 500MB
    const MAX_FILES = 10;
    const MAX_HISTORY = 50;

    // Initialize FFmpeg
    async function initFFmpeg() {
      try {
        showStatus('Initializing video converter... This may take a moment.', 'info');
        
        ffmpeg = createFFmpeg({ 
          log: true,
          corePath: 'https://unpkg.com/@ffmpeg/core@0.12.4/dist/ffmpeg-core.js'
        });
        
        // Show progress during loading
        ffmpeg.setProgress(({ ratio }) => {
          if (ratio < 1) {
            showStatus(`Loading FFmpeg... ${Math.round(ratio * 100)}%`, 'info');
          }
        });
        
        await ffmpeg.load();
        console.log('FFmpeg loaded successfully');
        showStatus('Video converter ready! You can now convert files.', 'success');
        
        // Hide success message after 3 seconds
        setTimeout(() => {
          hideStatus();
        }, 3000);
        
      } catch (error) {
        console.error('Failed to load FFmpeg:', error);
        showStatus('Failed to initialize video converter. Please check your internet connection and refresh the page.', 'error');
      }
    }

    // Initialize on page load
    initFFmpeg();
    loadHistory();
    setupQueueControls();
    setupAdvancedSettings();
    setupKeyboardShortcuts();
    loadStats();
    
    // Update convert button when FFmpeg is ready
    function updateConvertButton() {
      if (ffmpeg && ffmpeg.isLoaded()) {
        convertBtn.textContent = 'Convert file â–¾';
        convertBtn.disabled = false;
      } else {
        convertBtn.textContent = 'Loading converter...';
        convertBtn.disabled = true;
      }
    }
    
    // Check FFmpeg status periodically
    setInterval(updateConvertButton, 1000);

    // drag/drop visual
    ['dragenter','dragover'].forEach(evt=>{
      uploader.addEventListener(evt, e=>{
        e.preventDefault();
        e.stopPropagation();
        uploader.classList.add('dragover');
      }, false);
    });
    ['dragleave','drop'].forEach(evt=>{
      uploader.addEventListener(evt, e=>{
        e.preventDefault();
        e.stopPropagation();
        uploader.classList.remove('dragover');
      }, false);
    });

    uploader.addEventListener('drop', e=>{
      const dt = e.dataTransfer;
      if(!dt) return;
      const dropped = Array.from(dt.files || []);
      handleFiles(dropped);
    });

    fileInput.addEventListener('change', e=>{
      handleFiles(Array.from(e.target.files || []));
      fileInput.value = ''; // reset to allow same file again
    });

    function handleFiles(list){
      if(list.length === 0) return;
      
      // Check file count limit
      if (files.length + list.length > MAX_FILES) {
        showStatus(`Maximum ${MAX_FILES} files allowed. Please remove some files first.`, 'error');
        return;
      }
      
      // Validate file types and sizes
      const validTypes = ['video/', 'audio/'];
      const validFiles = [];
      const invalidFiles = [];
      
      list.forEach(file => {
        const isValidType = validTypes.some(type => file.type.startsWith(type));
        const isValidSize = file.size <= MAX_FILE_SIZE;
        
        if (isValidType && isValidSize) {
          validFiles.push(file);
        } else {
          invalidFiles.push({
            name: file.name,
            reason: !isValidType ? 'Invalid file type' : 'File too large'
          });
        }
      });
      
      if (validFiles.length === 0) {
        showStatus('No valid files found. Please select video/audio files under 500MB.', 'error');
        return;
      }
      
      if (invalidFiles.length > 0) {
        const reasons = invalidFiles.map(f => `${f.name} (${f.reason})`).join(', ');
        showStatus(`Some files were skipped: ${reasons}`, 'error');
      }
      
      // Add new files to existing ones
      files = [...files, ...validFiles];
      
      // Update UI
      updateFilePreview();
      updateFileList();
      hideStatus();
    }

    function updateFileList() {
      if (files.length === 0) {
        selectedText.textContent = '';
        filehint.style.display = 'block';
        settingsPanel.style.display = 'none';
      } else {
        const names = files.map(f => f.name);
        selectedText.textContent = names.join(', ');
        filehint.style.display = 'none';
        settingsPanel.style.display = 'block';
      }
      chosen.textContent = targetFormat ? `Selected: ${targetFormat.toUpperCase()}` : '';
    }

    function updateFilePreview() {
      filePreview.innerHTML = '';
      
      files.forEach((file, index) => {
        const fileCard = document.createElement('div');
        fileCard.className = 'file-card';
        
        const isVideo = file.type.startsWith('video/');
        const fileSize = formatFileSize(file.size);
        const formatSuggestion = suggestFormat(file);
        
        fileCard.innerHTML = `
          <button class="file-remove" onclick="removeFile(${index})">Ã—</button>
          <div class="file-thumbnail">
            ${isVideo ? 'ðŸŽ¥' : 'ðŸŽµ'}
          </div>
          <div class="file-name">${file.name}</div>
          <div class="file-size">${fileSize}</div>
          ${formatSuggestion ? `<div class="format-suggestion">${formatSuggestion}</div>` : ''}
        `;
        
        // Generate video thumbnail if possible
        if (isVideo) {
          generateVideoThumbnail(file, fileCard.querySelector('.file-thumbnail'));
        }
        
        filePreview.appendChild(fileCard);
      });
    }

    function generateVideoThumbnail(file, thumbnailElement) {
      const video = document.createElement('video');
      video.style.display = 'none';
      video.muted = true;
      video.preload = 'metadata';
      
      video.onloadedmetadata = () => {
        video.currentTime = 1; // Seek to 1 second
      };
      
      video.onseeked = () => {
        const canvas = document.createElement('canvas');
        canvas.width = 80;
        canvas.height = 60;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, 80, 60);
        
        const img = document.createElement('img');
        img.src = canvas.toDataURL();
        thumbnailElement.innerHTML = '';
        thumbnailElement.appendChild(img);
        
        document.body.removeChild(video);
      };
      
      video.src = URL.createObjectURL(file);
      document.body.appendChild(video);
    }

    function removeFile(index) {
      files.splice(index, 1);
      updateFilePreview();
      updateFileList();
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // Queue Management
    function setupQueueControls() {
      startQueueBtn.addEventListener('click', startQueue);
      pauseQueueBtn.addEventListener('click', pauseQueue);
      clearQueueBtn.addEventListener('click', clearQueue);
      clearHistoryBtn.addEventListener('click', clearHistory);
    }

    function addToQueue(fileList, format) {
      fileList.forEach(file => {
        const queueItem = {
          id: Date.now() + Math.random(),
          file: file,
          format: format,
          status: 'pending',
          progress: 0,
          error: null,
          startTime: null,
          endTime: null
        };
        conversionQueue.push(queueItem);
      });
      
      updateQueueDisplay();
      queuePanel.style.display = 'block';
    }

    function updateQueueDisplay() {
      queueList.innerHTML = '';
      
      conversionQueue.forEach((item, index) => {
        const queueItem = document.createElement('div');
        queueItem.className = 'queue-item';
        
        const statusText = {
          'pending': 'Waiting',
          'processing': 'Converting',
          'completed': 'Completed',
          'error': 'Failed'
        };
        
        queueItem.innerHTML = `
          <div class="queue-item-status ${item.status}"></div>
          <div class="queue-item-info">
            <div class="queue-item-name">${item.file.name}</div>
            <div class="queue-item-details">${statusText[item.status]} â†’ ${item.format.toUpperCase()}</div>
          </div>
          <div class="queue-item-actions">
            ${item.status === 'pending' ? `<button class="queue-item-btn" onclick="removeFromQueue(${index})">Remove</button>` : ''}
            ${item.status === 'error' ? `<button class="queue-item-btn" onclick="retryQueueItem(${index})">Retry</button>` : ''}
          </div>
        `;
        
        queueList.appendChild(queueItem);
      });
    }

    function startQueue() {
      if (isQueueRunning) return;
      
      isQueueRunning = true;
      isQueuePaused = false;
      startQueueBtn.textContent = 'Running...';
      startQueueBtn.disabled = true;
      pauseQueueBtn.disabled = false;
      
      processQueue();
    }

    function pauseQueue() {
      isQueuePaused = !isQueuePaused;
      pauseQueueBtn.textContent = isQueuePaused ? 'Resume' : 'Pause';
    }

    function clearQueue() {
      conversionQueue = [];
      updateQueueDisplay();
      queuePanel.style.display = 'none';
      isQueueRunning = false;
      isQueuePaused = false;
      startQueueBtn.textContent = 'Start All';
      startQueueBtn.disabled = false;
      pauseQueueBtn.disabled = true;
    }

    async function processQueue() {
      while (conversionQueue.length > 0 && isQueueRunning && !isQueuePaused) {
        const pendingItems = conversionQueue.filter(item => item.status === 'pending');
        
        if (pendingItems.length === 0) {
          break;
        }
        
        const item = pendingItems[0];
        item.status = 'processing';
        item.startTime = new Date();
        updateQueueDisplay();
        
        try {
          const result = await convertSingleFile(item.file, item.format);
          item.status = 'completed';
          item.endTime = new Date();
          
                     // Add to history and update stats
           const conversionTime = Math.round((item.endTime - item.startTime) / 1000);
           addToHistory(item.file.name, item.format, result.filename, item.startTime, item.endTime);
           updateStats(conversionTime);
          
          // Download file
          const link = document.createElement('a');
          link.href = result.url;
          link.download = result.filename;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
        } catch (error) {
          item.status = 'error';
          item.error = error.message;
          item.endTime = new Date();
          console.error('Queue conversion error:', error);
        }
        
        updateQueueDisplay();
        
        // Remove completed/error items after a delay
        setTimeout(() => {
          conversionQueue = conversionQueue.filter(item => item.status === 'pending' || item.status === 'processing');
          updateQueueDisplay();
        }, 3000);
      }
      
      if (conversionQueue.length === 0) {
        isQueueRunning = false;
        startQueueBtn.textContent = 'Start All';
        startQueueBtn.disabled = false;
        pauseQueueBtn.disabled = true;
        queuePanel.style.display = 'none';
      }
    }

    function removeFromQueue(index) {
      conversionQueue.splice(index, 1);
      updateQueueDisplay();
    }

    function retryQueueItem(index) {
      const item = conversionQueue[index];
      item.status = 'pending';
      item.error = null;
      item.startTime = null;
      item.endTime = null;
      updateQueueDisplay();
    }

    // History Management
    function addToHistory(fileName, format, outputName, startTime, endTime) {
      const historyItem = {
        id: Date.now(),
        fileName: fileName,
        format: format,
        outputName: outputName,
        startTime: startTime,
        endTime: endTime,
        duration: Math.round((endTime - startTime) / 1000)
      };
      
      conversionHistory.unshift(historyItem);
      
      // Keep only recent items
      if (conversionHistory.length > MAX_HISTORY) {
        conversionHistory = conversionHistory.slice(0, MAX_HISTORY);
      }
      
      saveHistory();
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      if (conversionHistory.length === 0) {
        historyPanel.style.display = 'none';
        return;
      }
      
      historyPanel.style.display = 'block';
      historyList.innerHTML = '';
      
      conversionHistory.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        
        historyItem.innerHTML = `
          <div class="history-item-icon">âœ“</div>
          <div class="history-item-info">
            <div class="history-item-name">${item.fileName}</div>
            <div class="history-item-details">${item.format.toUpperCase()} â€¢ ${item.duration}s â€¢ ${new Date(item.startTime).toLocaleTimeString()}</div>
          </div>
        `;
        
        historyList.appendChild(historyItem);
      });
    }

    function clearHistory() {
      conversionHistory = [];
      saveHistory();
      updateHistoryDisplay();
    }

    function saveHistory() {
      try {
        localStorage.setItem('vidter_history', JSON.stringify(conversionHistory));
      } catch (error) {
        console.error('Failed to save history:', error);
      }
    }

    function loadHistory() {
      try {
        const saved = localStorage.getItem('vidter_history');
        if (saved) {
          conversionHistory = JSON.parse(saved);
          updateHistoryDisplay();
        }
      } catch (error) {
        console.error('Failed to load history:', error);
      }
    }

    // Advanced Settings Management
    function setupAdvancedSettings() {
      advancedToggle.addEventListener('click', () => {
        const isVisible = advancedOptions.classList.contains('show');
        advancedOptions.classList.toggle('show');
        advancedToggle.textContent = isVisible ? 'Advanced Settings' : 'Hide Advanced Settings';
      });
    }

    // Keyboard Shortcuts
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + O to open file browser
        if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
          e.preventDefault();
          fileInput.click();
        }
        
        // Ctrl/Cmd + Enter to start conversion if format is selected
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && targetFormat && files.length > 0) {
          e.preventDefault();
          addToQueue(files, targetFormat);
        }
        
        // Escape to close format list
        if (e.key === 'Escape' && !formatList.hidden) {
          formatList.hidden = true;
          convertBtn.setAttribute('aria-expanded', 'false');
        }
        
        // ? to show shortcuts help
        if (e.key === '?') {
          e.preventDefault();
          showShortcutsHelp();
        }
      });
    }

    function showShortcutsHelp() {
      const shortcutsHTML = `
        <div class="shortcuts-panel">
          <div class="shortcuts-header">
            <div class="shortcuts-title">Keyboard Shortcuts</div>
            <button class="shortcuts-close" onclick="hideShortcutsHelp()">Ã—</button>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-action">Open file browser</span>
            <span class="shortcut-key">Ctrl+O</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-action">Start conversion</span>
            <span class="shortcut-key">Ctrl+Enter</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-action">Close format list</span>
            <span class="shortcut-key">Esc</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-action">Show this help</span>
            <span class="shortcut-key">?</span>
          </div>
        </div>
        <div class="overlay" onclick="hideShortcutsHelp()"></div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', shortcutsHTML);
      document.querySelector('.shortcuts-panel').style.display = 'block';
      document.querySelector('.overlay').style.display = 'block';
    }

    function hideShortcutsHelp() {
      const shortcutsPanel = document.querySelector('.shortcuts-panel');
      const overlay = document.querySelector('.overlay');
      if (shortcutsPanel) shortcutsPanel.remove();
      if (overlay) overlay.remove();
    }

    // Statistics Management
    function loadStats() {
      try {
        const saved = localStorage.getItem('vidter_stats');
        if (saved) {
          stats = JSON.parse(saved);
        }
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    function saveStats() {
      try {
        localStorage.setItem('vidter_stats', JSON.stringify(stats));
      } catch (error) {
        console.error('Failed to save stats:', error);
      }
    }

    function updateStats(conversionTime) {
      stats.totalConversions++;
      stats.totalFilesProcessed++;
      stats.totalTimeSaved += conversionTime;
      stats.averageConversionTime = stats.totalTimeSaved / stats.totalConversions;
      saveStats();
    }

    // File Format Detection and Suggestions
    function detectFileFormat(file) {
      const extension = getFileExtension(file.name).toLowerCase();
      const mimeType = file.type;
      
      const formatMap = {
        'mp4': ['mp4', 'm4v', 'mov'],
        'webm': ['webm'],
        'avi': ['avi'],
        'mov': ['mov', 'qt'],
        'mp3': ['mp3', 'wav', 'aac', 'ogg', 'flac']
      };
      
      for (const [format, extensions] of Object.entries(formatMap)) {
        if (extensions.includes(extension)) {
          return format;
        }
      }
      
      // Fallback based on MIME type
      if (mimeType.startsWith('video/')) {
        return 'mp4'; // Default video format
      } else if (mimeType.startsWith('audio/')) {
        return 'mp3'; // Default audio format
      }
      
      return null;
    }

    function suggestFormat(file) {
      const detectedFormat = detectFileFormat(file);
      if (detectedFormat) {
        return `Suggested format: ${detectedFormat.toUpperCase()}`;
      }
      return null;
    }

    // convert button toggles formats
    convertBtn.addEventListener('click', ()=>{
      const open = formatList.hidden;
      formatList.hidden = !open;
      convertBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
    });

    // format buttons
    document.querySelectorAll('.format-card').forEach(card=>{
      card.addEventListener('click', async ()=>{
        targetFormat = card.dataset.format;
        chosen.textContent = `Selected: ${targetFormat.toUpperCase()}`;
        formatList.hidden = true;

        if(files.length === 0){
          showStatus('No files selected. Please drag & drop or browse files first.', 'error');
          return;
        }

        if (!ffmpeg || !ffmpeg.isLoaded()) {
          showStatus('Video converter is still initializing. Please wait for the "Video converter ready!" message.', 'error');
          return;
        }

        // Add files to queue instead of immediate conversion
        addToQueue(files, targetFormat);
        showStatus(`${files.length} file(s) added to conversion queue. Click "Start All" to begin.`, 'success');
        
        // Reset file selection
        files = [];
        updateFilePreview();
        updateFileList();
      });
    });

    async function convertFiles(fileList, format) {
      try {
        convertBtn.disabled = true;
        convertBtn.textContent = `Converting ${fileList.length} file(s) â†’ ${format.toUpperCase()}...`;
        progressContainer.style.display = 'block';
        progressFill.style.width = '0%';
        progressText.textContent = 'Preparing conversion...';
        hideStatus();

        const results = [];
        
        for (let i = 0; i < fileList.length; i++) {
          const file = fileList[i];
          const progress = ((i / fileList.length) * 100).toFixed(1);
          progressFill.style.width = `${progress}%`;
          progressText.textContent = `Converting ${file.name}... (${i + 1}/${fileList.length})`;
          
          const result = await convertSingleFile(file, format);
          results.push(result);
        }

        progressFill.style.width = '100%';
        progressText.textContent = 'Conversion complete!';
        
        // Create download links
        results.forEach((result, index) => {
          const link = document.createElement('a');
          link.href = result.url;
          link.download = result.filename;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });

        showStatus(`Successfully converted ${results.length} file(s) to ${format.toUpperCase()}!`, 'success');
        
                 // Reset UI
         setTimeout(() => {
           progressContainer.style.display = 'none';
           convertBtn.disabled = false;
           convertBtn.textContent = 'Convert file â–¾';
           files = [];
           updateFilePreview();
           updateFileList();
           chosen.textContent = '';
         }, 3000);

      } catch (error) {
        console.error('Conversion error:', error);
        showStatus(`Conversion failed: ${error.message}`, 'error');
        progressContainer.style.display = 'none';
        convertBtn.disabled = false;
        convertBtn.textContent = 'Convert file â–¾';
      }
    }

         async function convertSingleFile(file, format) {
       const inputName = `input_${Date.now()}.${getFileExtension(file.name)}`;
       const outputName = `output_${Date.now()}.${format}`;
       
       // Write file to FFmpeg
       ffmpeg.FS('writeFile', inputName, await file.arrayBuffer());
       
       // Get quality settings
       const quality = qualitySelect.value;
       const audioBitrate = audioBitrateSelect.value;
       
       // Get advanced settings if available
       const resolution = videoResolution.value || '1920x1080';
       const fps = frameRate.value || '30';
       const videoBitrateValue = videoBitrate.value || '2';
      
      // Build FFmpeg command based on format and quality settings
      let command = [];
      
      if (format === 'mp3') {
        command = ['-i', inputName, '-vn', '-acodec', 'mp3', '-ab', `${audioBitrate}k`, outputName];
             } else if (format === 'mp4') {
         const videoSettings = getVideoSettings(quality);
         command = [
           '-i', inputName, 
           '-c:v', 'libx264', 
           '-preset', videoSettings.preset,
           '-crf', videoSettings.crf,
           '-vf', `scale=${resolution}:force_original_aspect_ratio=decrease`,
           '-r', fps,
           '-c:a', 'aac', 
           '-b:a', `${audioBitrate}k`,
           outputName
         ];
             } else if (format === 'webm') {
         const videoSettings = getVideoSettings(quality);
         command = [
           '-i', inputName, 
           '-c:v', 'libvpx-vp9', 
           '-crf', videoSettings.crf,
           '-vf', `scale=${resolution}:force_original_aspect_ratio=decrease`,
           '-r', fps,
           '-b:v', videoSettings.bitrate,
           '-c:a', 'libopus', 
           '-b:a', `${audioBitrate}k`,
           outputName
         ];
             } else if (format === 'mov') {
         const videoSettings = getVideoSettings(quality);
         command = [
           '-i', inputName, 
           '-c:v', 'libx264', 
           '-preset', videoSettings.preset,
           '-crf', videoSettings.crf,
           '-vf', `scale=${resolution}:force_original_aspect_ratio=decrease`,
           '-r', fps,
           '-c:a', 'aac', 
           '-b:a', `${audioBitrate}k`,
           '-f', 'mov', 
           outputName
         ];
             } else if (format === 'avi') {
         const videoSettings = getVideoSettings(quality);
         command = [
           '-i', inputName, 
           '-c:v', 'libx264', 
           '-preset', videoSettings.preset,
           '-crf', videoSettings.crf,
           '-vf', `scale=${resolution}:force_original_aspect_ratio=decrease`,
           '-r', fps,
           '-c:a', 'mp3', 
           '-b:a', `${audioBitrate}k`,
           outputName
         ];
      }
      
      // Run conversion
      await ffmpeg.run(...command);
      
      // Read result
      const data = ffmpeg.FS('readFile', outputName);
      
      // Clean up
      ffmpeg.FS('unlink', inputName);
      ffmpeg.FS('unlink', outputName);
      
      // Create download URL
      const blob = new Blob([data.buffer], { type: getMimeType(format) });
      const url = URL.createObjectURL(blob);
      
      const filename = file.name.replace(/\.[^/.]+$/, '') + '.' + format;
      
      return { url, filename };
    }

    function getVideoSettings(quality) {
      switch (quality) {
        case 'high':
          return { preset: 'slow', crf: '18', bitrate: '2M' };
        case 'medium':
          return { preset: 'medium', crf: '23', bitrate: '1M' };
        case 'low':
          return { preset: 'fast', crf: '28', bitrate: '500k' };
        default:
          return { preset: 'medium', crf: '23', bitrate: '1M' };
      }
    }

    function getFileExtension(filename) {
      return filename.split('.').pop().toLowerCase();
    }

    function getMimeType(format) {
      const mimeTypes = {
        'mp4': 'video/mp4',
        'webm': 'video/webm',
        'mov': 'video/quicktime',
        'avi': 'video/x-msvideo',
        'mp3': 'audio/mpeg'
      };
      return mimeTypes[format] || 'application/octet-stream';
    }

         function showStatus(message, type) {
       statusMessage.textContent = message;
       statusMessage.className = `status-message status-${type}`;
       statusMessage.style.display = 'block';
       
       // Show notification for important messages
       if (type === 'success' || type === 'error') {
         showNotification(message, type);
       }
     }

     function showNotification(message, type) {
       const notification = document.createElement('div');
       notification.className = `notification ${type}`;
       notification.innerHTML = `
         <div style="font-weight:500;margin-bottom:4px;">${type === 'success' ? 'âœ“ Success' : type === 'error' ? 'âœ— Error' : 'â„¹ Info'}</div>
         <div style="font-size:13px;color:rgba(255,255,255,0.7);">${message}</div>
       `;
       
       document.body.appendChild(notification);
       
       // Show notification
       setTimeout(() => notification.classList.add('show'), 100);
       
       // Hide and remove after 4 seconds
       setTimeout(() => {
         notification.classList.remove('show');
         setTimeout(() => notification.remove(), 300);
       }, 4000);
     }

    function hideStatus() {
      statusMessage.style.display = 'none';
    }

    // keyboard accessibility: close formats when clicking outside
    document.addEventListener('click', (e)=>{
      if(!formatList.hidden && !convertBtn.contains(e.target) && !formatList.contains(e.target)){
        formatList.hidden = true;
        convertBtn.setAttribute('aria-expanded', 'false');
      }
    });

         // Add keyboard shortcut hint to footer
     document.addEventListener('DOMContentLoaded', () => {
       const footer = document.querySelector('footer div');
       footer.innerHTML += ' Â· Press ? for keyboard shortcuts';
     });

     // small improvement: show allowed types
     chosen.textContent = '';
  </script>
</body>
</html>
